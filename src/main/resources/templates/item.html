<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title>Item Management</title>
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<style>
body {
	background-color: #f8f9fa;
}

.container {
	max-width: 960px;
	margin-top: 2rem;
	padding: 2rem;
	background-color: #fff;
	border-radius: 0.5rem;
	box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
}

table {
	margin-top: 2rem;
}

.table th, .table td {
	vertical-align: middle;
}

.form-group {
	margin-top: 2rem;
}

#saveCategoryButton, #toggleButton {
	display: inline-block;
	margin-right: 10px; /* Add a little space between buttons */
}

.topnav {
	overflow: hidden;
	background-color: #333;
	display: flex;
	justify-content: space-between;
	align-items: center;
}

.topnav a {
	float: left;
	display: block;
	color: #f2f2f2;
	text-align: center;
	padding: 20px 16px; /* Increase the vertical padding */
	text-decoration: none;
	font-size: 17px;
}

.topnav a:hover {
	background-color: #ddd;
	color: black;
}

.topnav a.active {
	background-color: royalblue;
	color: white;
}

.topnav .title {
	color: #f2f2f2;
	font-size: 20px;
	font-weight: bold;
}
</style>
</head>
<body>

	<div class="topnav">
		<div>
			<!-- <a class="active" href="http://192.168.1.5:8086/api/showMenu">Home</a> -->
			<a href="http://192.168.1.5:8086/api/showMenu">RF Menu</a> <a
				href="http://192.168.1.5:8086/api/categoryInfo">Category</a> <a
				class="active" href="http://192.168.1.5:8086/api/itemInfo">Item</a> <a
				href="#location">Location</a> <a href="#lpnl">LPN</a>
		</div>
		<div class="title">Warehouse Management System</div>
	</div>

	</div>
	<div class="container">
		<h1 class="text-center">Item Management</h1>
		<!-- Category table -->
		<div style="width: 100%; height: 100%; overflow: auto;">
			<table class="table table-striped">
				<thead class="thead-dark">
					<tr>
						<th scope="col">#</th>
						<th scope="col">Item Name</th>
						<th scope="col">Category</th>
						<th scope="col">Actions</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="item : ${items}">
						<th scope="row" th:text="${item.item_id}"></th>
						<td th:text="${item.description}"></td>
						<td th:text="${item.category.category_name}"></td>
						<td>
							<button type="button" class="btn btn-primary" data-toggle="modal"
								data-target="#exampleModal" 
								th:data-item-id="${item.item_id}"
								th:data-description="${item.description}"
								th:data-category="${item.category.category_name}"
								th:data-length="${item.unit_length}"
								th:data-width="${item.unit_width}"
								th:data-height="${item.unit_height}"
								th:data-volume="${item.unit_volume}"
								onclick="showItem(this.getAttribute('data-item-id'),this.getAttribute('data-description'),
								this.getAttribute('data-category'),this.getAttribute('data-length'),this.getAttribute('data-width'),
								this.getAttribute('data-height'),this.getAttribute('data-volume'), true)">
								View</button>
							<button th:data-item-id="${item.item_id}"
								th:data-description="${item.description}"
								onclick="editItem(this.getAttribute('data-item-id'), this.getAttribute('data-description'))"
								class="btn btn-primary">Edit</button>
							<button th:data-item-id="${item.item_id}"
								th:data-description="${item.description}"
								onclick="confirmItemDeletion(this.getAttribute('data-item-id'),this.getAttribute('data-item-name'), true)"
								class="btn btn-danger">Delete</button>


						</td>
					</tr>
				</tbody>
			</table>
			<!-- Modal -->
			<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog"
    aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Item Details</h5>
                <button type="button" class="close" data-dismiss="modal"
                    aria-label="Close">
                    <span aria-hidden="true">Ã—</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Text fields for item details -->
                <form id="itemForm">
                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <label for="itemId">Item ID</label> <input type="text"
                                    class="form-control" id="itemId" readonly>
                            </div>
                            <div class="form-group">
                                <label for="itemName">Item Name</label> <input type="text"
                                    class="form-control" id="itemName">
                            </div>
                            <div class="form-group">
                                <label for="category">Category</label>
                                <input class="form-control" id="category" rows="3"></input>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group">
                                <label for="length">Length</label>
                                <input class="form-control" id="length" rows="3"></input>
                            </div>
                            <div class="form-group">
                                <label for="width">Width</label>
                                <input class="form-control" id="width" rows="3"></input>
                            </div>
                            <div class="form-group">
                                <label for="height">Height</label>
                                <input class="form-control" id="height" rows="3"></input>
                            </div>
                            <div class="form-group">
                                <label for="volume">Volume</label>
                                <input class="form-control" id="volume" rows="3"></input>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary"
                    data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary"
                    onclick="saveItem()">Save</button>
            </div>
        </div>
    </div>
</div>


			<div class="form-group" id="itemDiv" style="display: none;">
				<label for="item">Category</label> <input type="text" id="item"
					name="item" class="form-control" required> &nbsp<input
					type="button" class="btn btn-primary" value="Save"
					onclick="submitForm()" id="saveButton" style="display: none;">
				&nbsp
				<button class="btn btn-primary" onclick="cancelAddItem()"
					id="toggleCancelButton" style="display: none;">Cancel</button>
				<div>
					<button class="btn btn-primary" onclick="saveItem()"
						id="saveItemButton" style="display: none;">Save</button>
					&nbsp
					<button class="btn btn-primary" onclick="cancelEdit()"
						id="toggleButton" style="display: none;">Cancel</button>

				</div>

			</div>
			<input type="button" class="btn btn-primary" value="Add Item"
				onclick="showFields()" id="addItemButton">
		</div>
		<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
		<script
			src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
		<script
			src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
		<script type='text/javascript'>
		
		
		

	/* Toggle between adding and removing the "responsive" class to topnav when the user clicks on the icon */
	// Get all the menu items
var menuItems = document.querySelectorAll('.topnav a');

// Loop through the menu items
for (var i = 0; i < menuItems.length; i++) {
  // Add a click event listener to each menu item
  menuItems[i].addEventListener('click', function() {
    // Remove the 'active' class from all menu items
    for (var i = 0; i < menuItems.length; i++) {
      menuItems[i].classList.remove('active');
    }
    // Add the 'active' class to the clicked menu item
    this.classList.add('active');
  });
}

		var isButtonShown = false;
		var currentItemName = null;

		function showFields() {
			if (!isButtonShown) {
				document.getElementById('itemDiv').style.display = 'block';
				document.getElementById('saveButton').style.display = 'block';
				document.getElementById('toggleCancelButton').style.display = 'block';
				document.getElementById('addItemButton').style.display = 'none';
				isItemShown = true;
			} else {
				submitForm();
			}
		}
		function cancelAddItem() {
		    // Hide the category input field, save button, and cancel button
		    document.getElementById('itemDiv').style.display = 'none';
		    document.getElementById('saveItemButton').style.display = 'none';
		    document.getElementById('toggleCancelButton').style.display = 'none';
			
		    // Show the Add Category button
		    document.getElementById('addItemButton').style.display = 'block';
		    isItemShown = false;
		}
		function showItem(item_id,description,category,length,width,height,volume ){
			document.getElementById('itemId').value = item_id;
			document.getElementById('itemName').value = description;
			document.getElementById('category').value = category;
			document.getElementById('length').value = length;
			document.getElementById('width').value = width;
			document.getElementById('height').value = height;
			document.getElementById('volume').value = volume;
			// console.log(item_id,description,category,length,width,height,volume);

		}
		function submitForm() {
			var item_name = document.getElementById('item').value;
			console.log("Item Name : " + item_name);
			const ajaxRequest = {
				url : 'itemAdd/' + item_name,
				type : 'post',
				success : function(response, textStatus, xhr) {
					console.log("Status Code:", xhr.status
							+ ", Status Message " + textStatus);
					alert('Item added successfully');
					document.getElementById('itemDiv').style.display = 'none';
					document.getElementById('addItemButton').style.display = 'block';
					isItemShown = false;
					location.reload();

				},
				error : function(response) {
					alert('Error adding item');
					location.reload();
				}
			};

			$.ajax(ajaxRequest);
		}
		function cancelEdit() {
		    // Hide the category input field, save button, and cancel button
		    document.getElementById('itemDiv').style.display = 'none';
		    document.getElementById('saveItemButton').style.display = 'none';
		    document.getElementById('toggleButton').style.display = 'none';

		    // Show the Add Category button
		    document.getElementById('addItemButton').style.display = 'block';
			document.getElementById('item').value = '';

		}

		function editItem(item_id, description) {
			console.log("Editing : " + description);
			// Show the category input field with the current category name
			document.getElementById('itemDiv').style.display = 'block';
			document.getElementById('item').value = description;
			document.getElementById('saveButton').style.display = 'none';
			document.getElementById('addItemButton').style.display = 'none';
			document.getElementById('toggleButton').style.display = 'block';
			document.getElementById('saveItemButton').style.display = 'block';
			isItemShown = true;
			currentItemName = description;
		}
		function saveChanges() {
			var updated_item_name = document.getElementById('category').value;
			var data = JSON.stringify({
				'item_name' : updated_category_name
			});
			console.log(updated_category_name);
			$
					.ajax({
						url : '/api/categoryEdit/' + currentItemName,
						type : 'put',
						contentType : 'application/json',
						data : data,

						success : function(response, textStatus, xhr) {
							console.log("Status code:", xhr.status + ", "
									+ textStatus);
							alert('Category updated successfully');
							document.getElementById('categoryDiv').style.display = 'none';
							document.getElementById('toggleButton').value = 'Add Category';
							document.getElementById('saveButton').style.display = 'none';
							isItemShown = false;
							currentItemName = null;
							location.reload();
						},
						error : function(response) {
							alert('Error updating category');
							location.reload();
						}
					});
		}
		function confirmItemDeletion(category_id,category_name, deleteFlag) {
			if (deleteFlag) {
//				const confirmation = window
//						.confirm(`Are you sure you want to delete category '${category_name}'?`);
//				if (confirmation) {
	//				deleteCategory(category_name);
			//	}
				 Swal.fire({
			            title: 'Are you sure?',
			            text: `Are you sure you want to delete category '${category_name}'?`,
			            icon: 'warning',
			            showCancelButton: true,
			            confirmButtonColor: '#3085d6',
			            cancelButtonColor: '#d33',
			            confirmButtonText: 'Yes, delete it!',
			            cancelButtonText: 'No, cancel!'
			        }).then((result) => {
			            if (result.isConfirmed) {
			                deleteCategory(category_id);
			            }
			        });
			    }
		}

		function deleteCategory(category_id) {
			console.log(category_id);

			// Proceed with deletion if user clicks "Yes" button
			$
					.ajax({
						url : '/api/deleteCategory/' + category_id,
						type : 'delete',
						 success: function(response, textStatus, xhr) {
					            console.log("Status code:", xhr.status + ", " + textStatus);
					            Swal.fire('Deleted!', 'Category deleted successfully', 'success').then((result) => {
					                if (result.isConfirmed) {
					                    location.reload(); // Reload the page
					                }
					            });
					        },
	
					        error: function(response) {
					            Swal.fire('Error!', 'Error deleting category', 'error');
					        }
					});
		}
	</script>
</body>
</html>
